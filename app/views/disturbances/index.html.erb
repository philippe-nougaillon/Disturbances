<div class="w-full">

  <div class="flex justify-between items-center">
    <h1 class="font-bold text-4xl mt-1 mb-4">Perturbations</h1>
  </div>

  <%= form_tag disturbances_path, method: :get do %>
    <div class="flex">
      <div class="mr-4">
        <%= label_tag :search, "Origine/Provenance/Destination", class: "label" %>
        <%= text_field_tag :search,
                            params[:search],
                            class: "input input-bordered w-full max-w-xs",
                            placeholder: "Entrez un mot à rechercher" %>
      </div>

      <div class="mr-4">
        <%= label_tag :information, "Information", class: "label" %>
        <%= select_tag :information, 
                        options_for_select(@informations, params[:information]), 
                        include_blank: true,
                        class: 'select select-bordered', 
                        onchange: 'this.form.submit()' %>
      </div>

      <% if defined?(states) %>
        <div class="control select">
          <%= select_tag :state, 
                          options_for_select(states, params[:state]), 
                          include_blank: true,
                          onchange: 'this.form.submit()' %>
        </div>
      <% end %>
      <button class="button is-info mt-8">Rechercher</button>
    </div>
  <% end %>

  <div id="disturbances" class="my-4 overflow-x-auto">
    <table class="table table-zebra w-full">
      <thead>
        <tr>
          <th>Id</th>
          <th>Gare</th>
          <th>Train</th>
          <th><span>Destination</span>/<span>Provenance</th>
          <th>Prévu</th>
          <th>Réel</th>
          <th>Voie</th>
          <th>Perturbation</th>
          <th>Raison</th>
          <th>Enregistrée</th>
          <th colspan=1></th>
        </tr>
      </thead>
      <tbody>
        <%= render @disturbances %>
      </tbody>
    </table>
  </div>

  <%= paginate @disturbances %>

  <p>
    <%= link_to 'Export XLS', url_for(params.permit!.merge(format: :xls)) %>
    |
    Source :
    <%= link_to 'm.ter.sncf.com',
                'https://m.ter.sncf.com/grand-est/se-deplacer/prochains-departs/strasbourg-87212027',
                target: '_blank' %>
  </p>

</div>

<script type="text/javascript">
  setInterval(function() {
    window.location.reload();
  }, 5 * 60000); 
</script>
